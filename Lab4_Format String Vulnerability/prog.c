#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <stdint.h>

#ifndef BUF_SIZE
#define BUF_SIZE 166
#endif

char *secret = "A secret message\n";
unsigned int  target = 0x11223344;

void details(char *msg)
{
    uintptr_t framep;
    // Copy the ebp value into framep, and print it out
    asm("movl %%ebp, %0" : "=r"(framep));
    printf("The ebp value inside details() is: 0x%.8x\n", framep);
    char dummy[BUF_SIZE];  memset(dummy, 0, BUF_SIZE);
    printf(msg);
    printf("The value of the 'target' variable (after): 0x%.8x\n", target);
}

void helper()
{
    printf("The address of the secret: 0x%.8x\n", (unsigned) secret);
    printf("The address of the 'target' variable: 0x%.8x\n",
            (unsigned) &target);
    printf("The value of the 'target' variable (before): 0x%.8x\n", target);
}

void main(int argc, char* argv[])
{
    char buf[1500];
    char dummy[BUF_SIZE];  memset(dummy, 0, BUF_SIZE);
    printf("The address of the input array: 0x%.8x\n", (unsigned) buf);
    helper();
    snprintf(buf, sizeof(buf), argv[1]);
    buf[sizeof(buf) - 1] = '\0';
    details(buf);
}
