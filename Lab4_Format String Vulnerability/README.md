## Goal

The main objective of this lab is to exploit multiple format string vulnerabilities.

## 1. Prerequisites

```
(a) Disable address space randomization
$ sudo sysctl -w kernel.randomize_va_space=0
```

```
(b) Building the vulnerable C program
$ gcc -o prog -z execstack -fno-stack-protector prog.c
```

```
(c) Running the program
$ ./prog $(cat payload)
```

```
Cybersecurity Lab II
Lab 04 -- Format String Vulnerability
```

## 2. Tasks

The provided C program has a format string vulnerability. Your task is to exploit multiple format string vulnerabilities that we discussed in the lecture.
You should set the BUF_SIZE to be 100+x, where x is the least significant two digits in your SFU ID. If these two digits are zeros, choose the next significant two digits.

To aid you with the tasks, the code of a generic payload generator is provided (called
build_string.py). For each of the tasks from 2 to 5, you will need to develop a different Python code based on that provided code. In addition to a detailed lab report, all Python scripts and generated payload files need to be submitted.
As usual, your lab report should include all steps you performed to generate the payload files with sufficient explanations and screenshots.

### Task 1: Inspect the Program

Your first task is to inspect the provided program and answer the following questions.
(a) What is the piece of code that may result in a format string vulnerability? Explain.
(b) Draw a simplified stack layout when the second printf function is invoked from the details function. You also need to show where the buf array is located (i.e., what stack frame is it located at?). Your drawing doesn’t need to show absolute addresses.

### Task 2: Crash the Process

Your task is to write a build_string_crash.py script that generates payload_crash. This payload should crash the process.

### Task 3: Print Values from the Stack

Your task is to write a build_string_print.py that generates payload_print. The payload should instruct the program to print any number of values from the stack.

### Task 4: Print a Value from the Heap

Similar to the previous tasks, you need to write a python script called build_string_heap.py that generates a payload_heap file.
Your task is to read the secret value from the heap. To help you with this task, the address of the variable is given to you. If you succeed, the secret message should be printed on the screen.

### Task 5: Modify a Value on the Stack

This task has four subtasks. For each subtask, you need to write a script called build_string_modifyX.py to generate payload_modifyX, where X is the subtask number.

**Subtask 1. You need to modify the value of the target variable to any arbitrary value.**

**Subtask 2. You need to modify the value of the target variable to be 0x400.**

**Subtask 3. You need to modify the value of the target variable to be 0x0904bc04.**

**Subtask 4. You need to modify the value of the target variable to be 0xff990000.**
